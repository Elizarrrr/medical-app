// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")  // Add this line back
}

model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.String
  access_token      String? @db.String
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.String
  session_state     String?

  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  USER
  ADMIN
  DOCTOR
}

model User {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  slug            String        @default("slug")
  email           String        @unique
  phone           String
  emailVerified   DateTime?
  image           String?
  role            UserRole      @default(USER)
  plan            String?
  password        String
  accounts        Account[]
  sessions        Session[]
  doctorProfile   DoctorProfile?

  serviceId       String?       @db.ObjectId
  service         Service?      @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  specialtyId     String?       @db.ObjectId
  specialty       Specialty?    @relation(fields: [specialtyId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  isVerfied       Boolean       @default(false)
  token           Int
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model DoctorProfile {
  id                   String           @id @default(auto()) @map("_id") @db.ObjectId
  userId               String           @unique @db.ObjectId
  user                 User             @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  trackingNumber       String           @unique
  status               DoctorStatus     @default(pending)

  firstName            String
  lastName             String
  dob                  DateTime?
  gender               String
  page                 String
  availability         Availability?

  profilePicture       String?
  bio                  String?
  medicalLicense       String?
  medicalLicenseExpiry DateTime?
  yearsOfExperience    Int?

  email                String?
  phone                String?
  country              String?
  city                 String?
  operationMode        String?          @default("Telehealth Visit")
  hourlyWage           Int @default(100)

  //SERVICES
  serviceId            String?          @db.ObjectId
  service              Service?         @relation(fields: [serviceId], references: [id])
  specialtyId          String?          @db.ObjectId
  specialty            Specialty?       @relation(fields: [specialtyId], references: [id])

  createdAt            DateTime         @default(now())
  updatedAt            DateTime?        @updatedAt
}

enum DoctorStatus {
  pending
  approved
  rejected
}

model Availability {
  id                 String           @id @default(auto()) @map("_id") @db.ObjectId
  doctorProfileId    String           @unique @db.ObjectId
  doctorProfile      DoctorProfile    @relation(fields: [doctorProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  monday             String[]
  tuesday            String[]
  wednesday          String[]
  thursday           String[]
  friday             String[]
  saturday           String[]
  sunday             String[]

  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
}

model Service {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  doctors          User[]
  title            String
  slug             String           @unique
  imageUrl         String

  doctorProfiles   DoctorProfile[]

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

model Specialty {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  doctors          User[]
  title            String
  slug             String @unique

  doctorProfiles   DoctorProfile[]

  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
}

model Inbox {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  receiverId      String
  userId          String
  senderId        String
  senderName      String
  senderEmail     String
  subject         String
  body            String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

enum AppointmentStatus {
  pending
  rejected
  approved
}

model Appointment {
  id                         String           @id @default(auto()) @map("_id") @db.ObjectId
  
  appointmentDate            DateTime?
  appointmentFormattedDate   String?
  doctorId                   String
  doctorName                 String?
  patientId                  String
  charge                     Int
  appointmentTime            String?

  //Patient details
  firstName                  String?
  lastName                   String? 
  gender                     String?
  phone                      String?
  email                      String?
  dob                        DateTime?
  location                   String?
  appointmentReason          String?
  occupation                 String?
  //medicalDocuments           String[]

  status                     AppointmentStatus    @default(pending)
  meetingLink                String               @default("")
  meetingProvider            String               @default("zoom")

  createdAt                  DateTime             @default(now())
  updatedAt                  DateTime             @updatedAt
}
